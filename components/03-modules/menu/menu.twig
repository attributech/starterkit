{% import _self as menus %}

{#
  We call a macro which calls itself to render the full tree.
  @see http://twig.sensiolabs.org/doc/tags/macro.html
#}

{{ menus.menu_links(items, attributes, 0, menu_name) }}

{% macro menu_links(items, attributes, menu_level, menu_name) %}
  {% import _self as menus %}

  {{ ( items|length ? '<ul class="menu menu--level--' ~ menu_level ~ '">' )|raw }}

  {% block menu_items %}
    {% for item in items %}
      <li class="menu__item {{ item.in_active_trail and item.below ? ' menu__item--active menu__item--open' }}{{ item.below ? ' menu__item--has-sub-items' }}">
        <a href="{{ item.url }}" class="menu__item-link{{ item.in_active_trail ? ' menu__item-link--active' }}">
          {{ item.title }}
        </a>
        {{ menus.menu_links(item.below, attributes, menu_level + 1, menu_name) }}
      </li>
    {% endfor %}
  {% endblock %}

  {{ items|length ? '</ul>' : '' }}
{% endmacro %}
